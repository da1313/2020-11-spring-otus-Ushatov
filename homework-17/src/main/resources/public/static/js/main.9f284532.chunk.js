(this.webpackJsonpui=this.webpackJsonpui||[]).push([[0],{61:function(e,t,n){},62:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(29),s=n.n(c),o=n(14),i=n(31),u=n(2),l=n(0);var d=function(e){var t=e.book,n=e.returnBook;return void 0===t._links.return?Object(l.jsx)("button",{className:"button-disabled",disabled:!0,children:"return"}):Object(l.jsx)("button",{onClick:function(){return n(t)},children:"return"})};var j=function(e){var t=e.book,n=e.takeBook;return void 0===t._links.take?Object(l.jsx)("button",{className:"button-disabled",disabled:!0,children:"take"}):Object(l.jsx)("button",{onClick:function(){return n(t)},children:"take"})},b=n(8),h=n.n(b),O=n(11),p=n(12),x=n(13),f=n(9),k=n.n(f),v=new(function(){function e(){Object(p.a)(this,e)}return Object(x.a)(e,[{key:"fetchHypermedia",value:function(){var e=Object(O.a)(h.a.mark((function e(){var t,n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("hypermedia"),null!==(n=null===t?null:JSON.parse(localStorage.getItem("hypermedia")))){e.next=10;break}return e.next=5,k.a.get("/hypermedia");case 5:return r=e.sent,localStorage.setItem("hypermedia",JSON.stringify(r.data._links)),e.abrupt("return",r.data._links);case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}()),g=new(function(){function e(){Object(p.a)(this,e)}return Object(x.a)(e,[{key:"getBooks",value:function(){var e=Object(O.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.fetchHypermedia();case 2:return t=e.sent,e.next=5,k.a.get(t.books_taken.href);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getBook",value:function(){}},{key:"takeBook",value:function(e){return k.a.post(e._links.take.href)}},{key:"returnBook",value:function(e){return k.a.post(e._links.return.href)}}]),e}()),m=new(function(){function e(){Object(p.a)(this,e)}return Object(x.a)(e,[{key:"sendLogin",value:function(){var e=Object(O.a)(h.a.mark((function e(t,n,r){var a,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("username",t),a.append("password",n),e.next=5,k.a.post("/login",a,{headers:{"Content-Type":"multipart/form-data"}});case 5:if(c=e.sent,!c.data.result){e.next=15;break}return localStorage.setItem("isAuthenticated",!0),localStorage.setItem("user",c.data.user),localStorage.setItem("date",(new Date).getTime()),r.setState({isAuthenticated:!0,user:c.data.user}),e.abrupt("return",!0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendLogout",value:function(){k.a.get("/logout").then((function(e){e.data.result&&localStorage.clear()}))}}]),e}());var y=function(){var e=Object(u.g)(),t=Object(r.useState)({books:[]}),n=Object(o.a)(t,2),a=n[0],c=n[1],s=Object(r.useContext)(_),i=function(){g.getBooks().then((function(t){if(null!==t.data.is_auth&&!1===t.data.is_auth)return localStorage.clear(),void e.push("/login");var n=t.data._embedded.books;c({books:n})}))};Object(r.useEffect)((function(){i()}),[]);var b=function(t){g.takeBook(t).then((function(t){if(null!==t.data.is_auth&&!1===t.data.is_auth)return localStorage.clear(),void e.push("/login");t.data.result?i():console.log("error!")}))},h=function(t){g.returnBook(t).then((function(t){if(null!==t.data.is_auth&&!1===t.data.is_auth)return localStorage.clear(),void e.push("/login");t.data.result?i():console.log("error!")}))};return Object(l.jsxs)("div",{children:[Object(l.jsx)("div",{className:"header",children:Object(l.jsx)("div",{children:"Ridiculously simple library simulation!(but made on HATEOAS)"})}),Object(l.jsxs)("div",{className:"nav",children:[Object(l.jsx)("div",{className:"login-info",children:Object(l.jsxs)("span",{children:["Logged in as:",s.state.user]})}),Object(l.jsx)("div",{children:Object(l.jsx)("button",{onClick:function(){m.sendLogout(),e.push("/login")},children:"log out"})})]}),Object(l.jsxs)("table",{children:[Object(l.jsx)("thead",{children:Object(l.jsxs)("tr",{children:[Object(l.jsx)("th",{children:"Title"}),Object(l.jsx)("th",{children:"Author"}),Object(l.jsx)("th",{children:"Genre"}),Object(l.jsx)("th",{children:"Quantity"}),Object(l.jsx)("th",{children:"Take"}),Object(l.jsx)("th",{children:"Return"})]})}),Object(l.jsx)("tbody",{children:a.books.map((function(e,t){return Object(l.jsxs)("tr",{children:[Object(l.jsx)("td",{children:e.title}),Object(l.jsx)("td",{children:e.author.name}),Object(l.jsx)("td",{children:e.genre.name}),Object(l.jsx)("td",{children:e.quantity}),Object(l.jsx)("td",{children:Object(l.jsx)(j,{book:e,takeBook:b})}),Object(l.jsx)("td",{children:Object(l.jsx)(d,{book:e,returnBook:h})})]},t)}))})]})]})};var w=function(e){var t=e.url,n=Object(u.g)(),a=Object(r.useContext)(_),c=Object(r.useState)({}),s=Object(o.a)(c,2),i=s[0],d=s[1];return Object(l.jsxs)("div",{className:"login",children:[Object(l.jsx)("div",{className:"header",children:Object(l.jsx)("div",{children:"Please sigh in!"})}),Object(l.jsx)("div",{children:i.isFailed?Object(l.jsx)("span",{children:"Bad credentials!"}):Object(l.jsx)("span",{})}),Object(l.jsx)("div",{children:Object(l.jsx)("input",{type:"text",name:"username",placeholder:"username",onChange:function(e){var t=e.target.value;d({username:t,password:i.password})}})}),Object(l.jsx)("div",{children:Object(l.jsx)("input",{type:"password",name:"password",placeholder:"password",onChange:function(e){var t=e.target.value;d({username:i.username,password:t})}})}),Object(l.jsx)("div",{children:Object(l.jsx)("button",{type:"submit",onClick:function(){m.sendLogin(i.username,i.password,a).then((function(e){e?n.push(t):d({username:i.username,password:i.password,isFailed:!0})}))},children:"Sign in"})})]})};var S=function(){return Object(l.jsx)("h1",{children:"There is no such page!"})},_=a.a.createContext();var B=function(){var e=localStorage.getItem("isAuthenticated"),t=null!==e&&e,n=localStorage.getItem("user"),a=Object(r.useState)({isAuthenticated:t,userStored:n}),c=Object(o.a)(a,2),s=c[0],d=c[1];return Object(l.jsx)("div",{className:"main",children:Object(l.jsx)(_.Provider,{value:{state:s,setState:d},children:Object(l.jsx)(i.a,{children:Object(l.jsxs)(u.d,{children:[Object(l.jsx)(u.b,{exact:!0,path:"/",children:Object(l.jsx)(u.a,{to:"/books"})}),Object(l.jsx)(u.b,{path:"/login",children:Object(l.jsx)(w,{url:"/books"})}),Object(l.jsx)(u.b,{path:"/books",render:function(){return s.isAuthenticated?Object(l.jsx)(y,{}):Object(l.jsx)(u.a,{to:"/login"})}}),Object(l.jsx)(u.b,{path:"*",component:S})]})})})})};n(61);s.a.render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(B,{})}),document.getElementById("root"))}},[[62,1,2]]]);
//# sourceMappingURL=main.9f284532.chunk.js.map